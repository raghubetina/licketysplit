<%# Accepts: line_item (required), check (optional), participants (optional) %>
<% check ||= line_item.check %>
<% participants ||= check.participants.order(:name) %>

<div id="<%= dom_id(line_item, :participant_toggles) %>" class="d-flex flex-wrap gap-3" data-controller="checkbox-toggle" data-checkbox-toggle-url-value="<%= toggle_participant_line_item_path(line_item) %>">
  <% if participants.any? %>
    <%= link_to "All", toggle_all_participants_line_item_path(line_item), data: { turbo_method: :post }, class: "text-muted small align-self-center" %>
  <% end %>
  <% participants.each do |participant| %>
    <div class="form-check form-switch m-0">
      <%= check_box_tag "participant_#{participant.id}",
          participant.id,
          line_item.participant_ids.include?(participant.id),
          id: "item_#{line_item.id}_participant_#{participant.id}",
          class: "form-check-input",
          role: "switch",
          data: { action: "change->checkbox-toggle#toggle" } %>
      <%= label_tag "item_#{line_item.id}_participant_#{participant.id}",
          participant.name,
          class: "form-check-label" %>
    </div>
  <% end %>
</div>
