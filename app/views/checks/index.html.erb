<div class="container py-3">
  <div class="card mb-4">
    <div class="card-header">
      <strong>Split a Check</strong>
    </div>
    <div class="card-body">
      <% if @check.errors.any? %>
        <div class="alert alert-danger">
          <ul class="mb-0">
            <% @check.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%= form_with url: checks_path, method: :post, local: true, multipart: true do |f| %>
        <div class="mb-3">
          <%= f.label :receipt_image, "Receipt Photo", class: "form-label" %>
          <%= f.file_field :receipt_image, class: "form-control", accept: "image/*", capture: "environment" %>
          <div class="form-text">Take a photo or upload an image of your receipt</div>
        </div>

        <div class="mb-3">
          <%= f.label :participant_names, "Who's splitting?", class: "form-label" %>
          <%= f.text_area :participant_names, class: "form-control", rows: 2, placeholder: "Alice, Bob, Carol, Dave" %>
          <div class="form-text">Enter names separated by commas</div>
        </div>

        <div class="d-grid">
          <%= f.submit "Parse Receipt", class: "btn btn-primary btn-lg" %>
        </div>
      <% end %>
    </div>
  </div>

  <% if @all_checks.present? %>
    <div class="card mb-4">
      <div class="card-header">
        <strong>All Checks</strong>
      </div>
      <ul class="list-group list-group-flush">
        <% @all_checks.each do |check| %>
          <%= link_to check, class: "list-group-item list-group-item-action d-flex justify-content-between align-items-start" do %>
            <div>
              <div class="fw-semibold"><%= check.restaurant_name || "Untitled Check" %></div>
              <% if check.participants.any? %>
                <div class="text-muted"><%= check.participants.order(:name).pluck(:name).to_sentence %></div>
              <% end %>
            </div>
            <div class="text-end">
              <div class="fw-semibold"><%= check.currency_symbol %><%= number_with_precision(check.grand_total, precision: 2) %></div>
              <% if check.billed_on.present? %>
                <div class="text-muted"><%= check.billed_on.strftime("%b %d, %Y") %></div>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% if @recent_checks.any? %>
    <div class="card">
      <div class="card-header">
        <strong>Recently Visited</strong>
      </div>
      <ul class="list-group list-group-flush">
        <% @recent_checks.each do |check| %>
          <%= link_to check, class: "list-group-item list-group-item-action d-flex justify-content-between align-items-start" do %>
            <div>
              <div class="fw-semibold"><%= check.restaurant_name || "Untitled Check" %></div>
              <% if check.participants.any? %>
                <div class="text-muted"><%= check.participants.order(:name).pluck(:name).to_sentence %></div>
              <% end %>
            </div>
            <div class="text-end">
              <div class="fw-semibold"><%= check.currency_symbol %><%= number_with_precision(check.grand_total, precision: 2) %></div>
              <% if check.billed_on.present? %>
                <div class="text-muted"><%= check.billed_on.strftime("%b %d, %Y") %></div>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
